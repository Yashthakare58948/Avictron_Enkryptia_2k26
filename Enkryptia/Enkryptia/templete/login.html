<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Smart OPD Login</title>
<style>
    * {margin:0; padding:0; box-sizing:border-box; font-family:'Arial',sans-serif;}
    body {height:100vh; background: linear-gradient(135deg,#1E90FF,#63B8FF); display:flex; justify-content:center; align-items:center;}
    
    .login-container {
        background-color:#fff;
        border-radius:20px;
        padding: 40px 30px;
        width:400px;
        box-shadow:0 15px 30px rgba(0,0,0,0.3);
        text-align:center;
        position:relative;
        overflow:hidden;
    }

    /* Role tabs */
    .role-tabs {
        display:flex;
        justify-content:space-between;
        margin-bottom:30px;
        border-radius:10px;
        position:relative;
        background-color:#f0f8ff;
        box-shadow:0 5px 15px rgba(0,0,0,0.1);
    }

    .role-tab {
        flex:1;
        padding:12px 0;
        cursor:pointer;
        font-weight:bold;
        text-transform: uppercase;
        color:#1E90FF;
        transition: all 0.3s ease;
        position:relative;
        z-index:1;
    }

    .role-tab:hover {color:#0d6efd;}

    .role-indicator {
        position:absolute;
        bottom:0;
        left:0;
        width:33.33%;
        height:4px;
        background-color:#1E90FF;
        border-radius:4px 4px 0 0;
        transition: all 0.3s ease;
    }

    h2 {color:#1E90FF; margin-bottom:25px;}

    input {
        width:100%; padding:12px 15px; margin:12px 0; border-radius:10px; border:1px solid #ccc; font-size:1em; transition: all 0.3s ease; box-shadow:0 2px 5px rgba(0,0,0,0.1);
    }

    input:focus {border-color:#1E90FF; box-shadow:0 4px 10px rgba(30,144,255,0.2); outline:none;}

    .login-btn {
        width:100%; padding:12px; margin-top:20px; border:none; border-radius:10px;
        background: linear-gradient(135deg,#1E90FF,#63B8FF);
        color:white; font-size:1.2em; font-weight:bold; cursor:pointer;
        transition: all 0.3s ease; box-shadow:0 5px 15px rgba(0,0,0,0.2);
    }

    .login-btn:hover {transform:scale(1.05); box-shadow:0 8px 20px rgba(0,0,0,0.3);}

    .back-home {display:inline-block; margin-top:15px; padding:10px 20px; color:#1E90FF; text-decoration:none; font-weight:bold; transition:all 0.3s ease;}
    .back-home:hover {color:#0d6efd; text-decoration:underline;}

    .signup {margin-top:20px; font-size:0.9em; color:#555;}
    .signup a {color:#1E90FF; text-decoration:none; font-weight:bold; transition:all 0.3s ease;}
    .signup a:hover {color:#0d6efd; text-decoration:underline;}

    @media(max-width:500px){.login-container{width:90%; padding:30px 20px;}}
</style>
</head>
<body>

<div class="login-container">

    <div class="role-tabs">
        <div class="role-tab" data-role="doctor">Doctor</div>
        <div class="role-tab active" data-role="patient">Patient</div>
        <div class="role-tab" data-role="admin">Admin</div>
        <div class="role-indicator"></div>
    </div>

    <h2>Login</h2>
    <input type="text" placeholder="Username" id="username">
    <input type="password" placeholder="Password" id="password">
    <button class="login-btn" onclick="login()">Login</button>
    <a href="/" class="back-home">Back to Homepage</a>

    <div class="signup">Don't have an account? <a href="/signuppage">Sign Up</a></div>
</div>

<script>
    let selectedRole = 'patient'; // default
    const tabs = document.querySelectorAll('.role-tab');
    const indicator = document.querySelector('.role-indicator');

    tabs.forEach((tab,index)=>{
        if(tab.classList.contains('active')){
            indicator.style.left = (index*33.33) + '%';
        }

        tab.addEventListener('click',()=>{
            // remove active
            tabs.forEach(t=>t.classList.remove('active'));
            tab.classList.add('active');
            selectedRole = tab.getAttribute('data-role');
            // move indicator
            indicator.style.left = (index*33.33) + '%';
        });
    });

    function login(){
    const username = document.getElementById('username').value.trim();
    const password = document.getElementById('password').value.trim();

    if(username === "" || password === ""){
        alert("Please fill all fields!");
        return;
    }

    fetch("/login", {
        method: "POST",
        headers: {
            "Content-Type": "application/json"
        },
        body: JSON.stringify({
            username: username,
            password: password,
            role: selectedRole
        })
    })
    .then(response => response.json())
    .then(data => {
        if(data.status === "success"){
            alert(`Logged in successfully as ${selectedRole}: ${username}`);

            // SAME redirection logic as before
            if(selectedRole==='doctor') window.location.href='/doctor';
            else if(selectedRole==='patient') window.location.href='/patient';
            else if(selectedRole==='admin') window.location.href='/admin';

        } else{
            alert("Invalid username or password for the selected role!");
        }
    })
    .catch(error => {
        console.error("Error:", error);
        alert("Server error. Please try again.");
    });
}
</script>

</body>
</html>
