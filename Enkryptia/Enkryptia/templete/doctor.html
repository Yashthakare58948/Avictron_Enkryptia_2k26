<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Doctor Dashboard</title>

<style>
body{font-family:Arial;margin:0;background:#f2f6fa;display:flex}

/* Sidebar */
.sidebar{
width:220px;background:#1E90FF;color:white;height:100vh;padding-top:20px
}
.sidebar h2{text-align:center}
.sidebar a{display:block;color:white;padding:15px;text-decoration:none}
.sidebar a:hover{background:#1874CD}

/* Main */
.main{flex:1;padding:30px}
.header{font-size:28px;color:#1E90FF;font-weight:bold;margin-bottom:20px}

/* Table */
table{width:100%;background:white;border-collapse:collapse;border-radius:10px;overflow:hidden}
th,td{padding:15px;border-bottom:1px solid #ddd}
th{background:#1E90FF;color:white}

/* Buttons */
.btn{padding:7px 14px;border:none;border-radius:7px;color:white;font-weight:bold;cursor:pointer}
.green{background:#28a745}
.blue{background:#1E90FF}
.red{background:#dc3545}

/* Modal */
.modal{
display:none;
position:fixed;
top:0;left:0;
width:100%;height:100%;
background:rgba(0,0,0,.5);
justify-content:center;align-items:center;
}

.box{
background:white;
padding:25px;
width:420px;
border-radius:15px;
}

select,input{padding:8px;margin-top:5px;margin-bottom:10px;width:100%}

.medbox{
background:#f1f1f1;
padding:10px;
margin-top:10px;
border-radius:8px;
}
</style>
</head>

<body>

<!-- Sidebar -->
<div class="sidebar">
<h2>Doctor Panel</h2>
<a href="/doctor">Dashboard</a>
<a href="#">Patients</a>
<a href="/logout">Logout</a>
</div>

<!-- Main -->
<div class="main">
<div class="header">Doctor Dashboard</div>

<table>
<thead>
<tr>
<th>Token</th>
<th>Name</th>
<th>Time</th>
<th>Status</th>
<th>Action</th>
</tr>
</thead>

<tbody>
<tr>
<td>1</td>
<td>Rutuja Kale</td>
<td>10:00</td>
<td>Waiting</td>
<td>
<button class="btn green" onclick="openModal(this)">Allocate</button>
<button class="btn blue" onclick="complete(this)">Complete</button>
<button class="btn red" onclick="leave(this)">Leave</button>
</td>
</tr>
</tbody>
</table>
</div>

<!-- Modal -->
<div class="modal" id="modal">
<div class="box">

<h2 style="color:#1E90FF">Prescription</h2>

<!-- Disease -->
<label>Disease</label>
<select id="disease">
<option>Fever</option>
<option>Cold</option>
<option>Diabetes</option>
<option>BP</option>
<option>Infection</option>
</select>

<input type="text" id="newDisease" placeholder="Enter new disease">
<button onclick="addDisease()">Add Disease</button>

<hr>

<!-- Medicine -->
<label>Medicine</label>
<select id="medSelect">
<option>Paracetamol</option>
<option>Ibuprofen</option>
<option>Antibiotic</option>
<option>Cough Syrup</option>
</select>

<input type="text" id="newMed" placeholder="Enter new medicine">
<button onclick="addNewMed()">Add Medicine To List</button>
<button onclick="addMed()">Add To Prescription</button>

<div id="medList"></div>

<br>

<button class="btn blue" onclick="printPrescription()">Print</button>
<button class="btn green" onclick="save()">Save</button>
<button class="btn red" onclick="closeModal()">Close</button>

</div>
</div>

<script>

let row;
let medicines=[];

/* OPEN MODAL */
function openModal(btn){
row=btn.closest("tr");
document.getElementById("modal").style.display="flex";
}

/* CLOSE */
function closeModal(){
document.getElementById("modal").style.display="none";
}

/* ADD NEW DISEASE */
function addDisease(){
let val=document.getElementById("newDisease").value.trim();
if(val==="") return alert("Enter disease");

let select=document.getElementById("disease");

let option=document.createElement("option");
option.text=val;
option.value=val;

select.appendChild(option);
select.value=val;

document.getElementById("newDisease").value="";
}

/* ADD NEW MEDICINE TO DROPDOWN */
function addNewMed(){
let val=document.getElementById("newMed").value.trim();
if(val==="") return alert("Enter medicine");

let select=document.getElementById("medSelect");

let option=document.createElement("option");
option.text=val;
option.value=val;

select.appendChild(option);
select.value=val;

document.getElementById("newMed").value="";
}

/* ADD MEDICINE */
function addMed(){

let name=document.getElementById("medSelect").value;

medicines.push({
name:name,
time:[],
days:1
});

renderMed();
}

/* RENDER MEDICINE */
function renderMed(){

let div=document.getElementById("medList");
div.innerHTML="";

medicines.forEach((m,i)=>{

div.innerHTML+=`
<div class="medbox">

<b>${m.name}</b>

<br><br>

<label><input type="checkbox" onchange="toggle(${i},'Morning')"> Morning</label>
<label><input type="checkbox" onchange="toggle(${i},'Noon')"> Noon</label>
<label><input type="checkbox" onchange="toggle(${i},'Evening')"> Evening</label>
<label><input type="checkbox" onchange="toggle(${i},'Night')"> Night</label>

<br><br>

Days:
<input type="number" value="${m.days}" min="1"
onchange="setDays(${i},this.value)">

<button onclick="del(${i})" style="background:red;color:white;border:none;padding:5px 10px;border-radius:5px">Delete</button>

</div>
`;
});
}

/* TIME */
function toggle(i,t){
let arr=medicines[i].time;
if(arr.includes(t))
medicines[i].time=arr.filter(x=>x!==t);
else
arr.push(t);
}

/* DAYS */
function setDays(i,val){
medicines[i].days=val;
}

/* DELETE */
function del(i){
medicines.splice(i,1);
renderMed();
}

/* SAVE */
function save(){
row.cells[3].innerText="Completed";
alert("Prescription Saved");
closeModal();
}

/* COMPLETE */
function complete(btn){
btn.closest("tr").cells[3].innerText="Completed";
}

/* LEAVE */
function leave(btn){
btn.closest("tr").cells[3].innerText="On Leave";
}

/* PRINT */
function printPrescription(){

let name=row.cells[1].innerText;
let disease=document.getElementById("disease").value;

let win=window.open("","","width=800,height=900");

let medHTML="";
medicines.forEach(m=>{
medHTML+=`<p>${m.name} — ${m.time.join(", ")} — ${m.days} days</p>`;
});

win.document.write(`
<div style="font-family:serif;padding:40px">
<h2 style="text-align:center">Hospital Name</h2>
<hr>

<p><b>Patient:</b> ${name}</p>
<p><b>Date:</b> ${new Date().toLocaleDateString()}</p>

<h3>Rx</h3>

<p><b>Disease:</b> ${disease}</p>

${medHTML}

<br><br><br>
<p>Doctor Signature: __________________________</p>
</div>
`);

win.print();
}

</script>

</body>
</html>